# üìò API Design Document
**D·ª± √°n:** PinkCapy E-Commerce
**Phi√™n b·∫£n:** v1
**M·ª•c ƒë√≠ch:** Chu·∫©n h√≥a thi·∫øt k·∫ø API t·ª´ d·ªØ li·ªáu th√¥ th√†nh c·∫•u tr√∫c RESTful c√≥ th·ªÉ sinh ra OpenAPI (Swagger) d·ªÖ d√†ng.

---

## I. Nguy√™n t·∫Øc thi·∫øt k·∫ø
1. **C·∫•u tr√∫c RESTful:**
   - S·ª≠ d·ª•ng HTTP methods theo chu·∫©n:
     - `GET` ‚Üí Truy v·∫•n ho·∫∑c xem d·ªØ li·ªáu  
     - `POST` ‚Üí T·∫°o m·ªõi d·ªØ li·ªáu  
     - `PUT` / `PATCH` ‚Üí C·∫≠p nh·∫≠t d·ªØ li·ªáu  
     - `DELETE` ‚Üí X√≥a d·ªØ li·ªáu  
2. **Ph·∫£n h·ªìi th·ªëng nh·∫•t (Response Wrapper):**
   ```json
   {
     "meta": {
       "code": "200000",
       "type": "SUCCESS",
       "message": "Success",
       "extra_meta": {}
     },
     "data": { ... }
   }
   ```
3. **Ph√¢n quy·ªÅn truy c·∫≠p:**
   - `public`: Ai c≈©ng xem ƒë∆∞·ª£c (s·∫£n ph·∫©m, danh m·ª•c).
   - `user`: Y√™u c·∫ßu `Authorization: user <user_id>`.
   - `admin`: Y√™u c·∫ßu `Authorization: admin <user_id>`.
4. **Pagination & Filter:**
   - Query params chung cho danh s√°ch:
     ```
     offset, limit, sort, category, price_min, price_max
     ```
5. **Tr·∫°ng th√°i (status):**
   - S·∫£n ph·∫©m: 1=Active, 2=Out of Stock, 3=Hidden, ...
   - ƒê∆°n h√†ng: Enum (pending, processing, shipped, completed, cancelled).

---

## II. C√°c nh√≥m API ch√≠nh

### 1Ô∏è‚É£. **S·∫£n ph·∫©m (Products)**

#### üìç GET /products
**M·ª•c ƒë√≠ch:** L·∫•y danh s√°ch s·∫£n ph·∫©m c√≥ ph√¢n trang v√† l·ªçc.  
**Tham s·ªë:**
| T√™n | Ki·ªÉu | M√¥ t·∫£ |
|------|------|--------|
| offset | int | V·ªã tr√≠ b·∫Øt ƒë·∫ßu |
| limit | int | S·ªë l∆∞·ª£ng tr·∫£ v·ªÅ |
| sort | string | Ti√™u ch√≠ s·∫Øp x·∫øp (vd: price:asc, created_at:desc) |
| category | int | ID danh m·ª•c |
| price_min | decimal | Gi√° nh·ªè nh·∫•t |
| price_max | decimal | Gi√° l·ªõn nh·∫•t |

**Ph·∫£n h·ªìi m·∫´u:**
```json
{
  "meta": { "code": "200000", "type": "SUCCESS", "message": "Success" },
  "data": {
    "limit": 1,
    "offset": 1,
    "total_count": 2,
    "has_more": false,
    "data": [
      {
        "id": 1,
        "category_id": 3,
        "title": "Tai nghe Bluetooth Sony WH-1000XM5",
        "slug": "tai-nghe-bluetooth-sony-wh-1000xm5",
        "thumb": "https://cdn.pinkcapy.vn/products/sony-wh1000xm5-thumb.jpg",
        "price": "8990000",
        "quantity": "25",
        "discount": 10,
        "ends_at": "2025-11-10T23:59:59Z"
      }
    ]
  }
}
```

#### üìç GET /products/{id}
**M·ª•c ƒë√≠ch:** Xem chi ti·∫øt s·∫£n ph·∫©m.  
**Ph·∫£n h·ªìi m·∫´u:**  
(ƒë√∫ng theo d·ªØ li·ªáu th√¥ ƒë√£ cho)

---

### 2Ô∏è‚É£. **Gi·ªè h√†ng (Carts)**

#### üìç GET /me/carts
**Authorization:** user  
**M·ª•c ƒë√≠ch:** Xem gi·ªè h√†ng hi·ªán t·∫°i c·ªßa ng∆∞·ªùi d√πng.  
**Ph·∫£n h·ªìi:**
```json
{
  "meta": { "code": "200000", "type": "SUCCESS" },
  "data": {
    "id": 1,
    "total_count": 2,
    "items": [
      {
        "id": 101,
        "product_id": 23,
        "quantity": 2,
        "price": 8990000,
        "discount": 500000,
        "note": "G√≥i qu√† sinh nh·∫≠t"
      }
    ]
  }
}
```

#### üìç POST /me/carts/items
**Authorization:** user  
**M·ª•c ƒë√≠ch:** Th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng.  
**Request body:**
```json
{
  "product_id": 23,
  "quantity": 2
}
```
**Response:**
```json
{
  "meta": { "code": "200000", "type": "SUCCESS" },
  "data": {
    "id": 101,
    "cart_id": 5,
    "product_id": 23,
    "quantity": 2,
    "price": 8990000,
    "discount": 500000,
    "note": "G√≥i qu√† sinh nh·∫≠t"
  }
}
```

---

### 3Ô∏è‚É£. **ƒê∆°n h√†ng (Orders)**

#### üìç POST /me/orders
**Authorization:** user  
**M·ª•c ƒë√≠ch:** ƒê·∫∑t h√†ng.  
**Request body:**
```json
{
  "promo": "SUMMER2025",
  "note": "Giao bu·ªïi s√°ng, g·ªçi tr∆∞·ªõc khi t·ªõi",
  "items": 1
}
```
**Response:**  
(ƒë√∫ng nh∆∞ m·∫´u trong d·ªØ li·ªáu th√¥)

---

#### üìç GET /me/orders/{id}/status
**Authorization:** user  
**M·ª•c ƒë√≠ch:** Ki·ªÉm tra tr·∫°ng th√°i ƒë∆°n h√†ng c·ªßa ng∆∞·ªùi d√πng.  
**Response:**
```json
{
  "meta": { "code": "200000", "type": "SUCCESS" },
  "data": { "id": 1001, "status": 3 }
}
```

---

### 4Ô∏è‚É£. **Qu·∫£n tr·ªã ƒë∆°n h√†ng (Admin Orders)**

#### üìç GET /admin/orders/{id}/status
**Authorization:** admin  
**M·ª•c ƒë√≠ch:** Xem tr·∫°ng th√°i ƒë∆°n h√†ng c·ªßa ng∆∞·ªùi d√πng (admin).  

#### üìç PUT /admin/orders/{id}/confirm
**Authorization:** admin  
**M·ª•c ƒë√≠ch:** X√°c nh·∫≠n ƒë∆°n h√†ng.  
**Response:**
```json
{
  "meta": { "code": "200000", "type": "SUCCESS" },
  "data": { "id": 1001, "status": 3 }
}
```

---

## III. C·∫•u tr√∫c d·ªØ li·ªáu ch√≠nh

### üß± Product
| Tr∆∞·ªùng | Ki·ªÉu | M√¥ t·∫£ |
|--------|------|--------|
| id | int | M√£ s·∫£n ph·∫©m |
| category_id | int | Danh m·ª•c |
| title | string | T√™n s·∫£n ph·∫©m |
| slug | string | URL th√¢n thi·ªán |
| thumb | string | ·∫¢nh ƒë·∫°i di·ªán |
| desc | text | M√¥ t·∫£ chi ti·∫øt |
| summary | string | T√≥m t·∫Øt |
| type | string | Lo·∫°i (headphone, keyboard, ...) |
| price | decimal | Gi√° b√°n |
| quantity | int | T·ªìn kho |
| status | int | Tr·∫°ng th√°i |
| discount | decimal | Gi·∫£m gi√° |
| ends_at | datetime | Th·ªùi gian k·∫øt th√∫c khuy·∫øn m√£i |

### üß± Cart Item
| Tr∆∞·ªùng | Ki·ªÉu | M√¥ t·∫£ |
|--------|------|--------|
| id | int | M√£ m·ª•c |
| product_id | int | S·∫£n ph·∫©m |
| quantity | int | S·ªë l∆∞·ª£ng |
| price | decimal | Gi√° t·ª´ng ƒë∆°n v·ªã |
| discount | decimal | M·ª©c gi·∫£m |
| note | string | Ghi ch√∫ ng∆∞·ªùi mua |

### üß± Order
| Tr∆∞·ªùng | Ki·ªÉu | M√¥ t·∫£ |
|--------|------|--------|
| id | int | M√£ ƒë∆°n h√†ng |
| user_id | int | Ng∆∞·ªùi ƒë·∫∑t |
| subtotal | decimal | T·ªïng ti·ªÅn h√†ng |
| tax | decimal | Thu·∫ø |
| shipping | decimal | Ph√≠ v·∫≠n chuy·ªÉn |
| total | decimal | T·ªïng ti·ªÅn tr∆∞·ªõc gi·∫£m |
| discount_total | decimal | T·ªïng gi·∫£m gi√° |
| promo | string | M√£ khuy·∫øn m√£i |
| grand_total | decimal | T·ªïng thanh to√°n |
| status | enum | pending / processing / completed |
| note | string | Ghi ch√∫ giao h√†ng |
| created_at / updated_at | datetime | Th·ªùi ƒëi·ªÉm t·∫°o/c·∫≠p nh·∫≠t |

---

## IV. H∆∞·ªõng d·∫´n tri·ªÉn khai
1. **B∆∞·ªõc 1:** T·∫°o c·∫•u tr√∫c DB t∆∞∆°ng ·ª©ng (`products`, `carts`, `cart_items`, `orders`, `order_items`).  
2. **B∆∞·ªõc 2:** Sinh m√¥ h√¨nh ORM (Eloquent / Sequelize / Prisma).  
3. **B∆∞·ªõc 3:** ƒê·ªãnh nghƒ©a route theo chu·∫©n RESTful.  
4. **B∆∞·ªõc 4:** X√¢y d·ª±ng `Response Wrapper` chu·∫©n h√≥a cho t·∫•t c·∫£ API.  
5. **B∆∞·ªõc 5:** Vi·∫øt `Swagger/OpenAPI` ƒë·ªÉ sinh docs t·ª± ƒë·ªông.  
